---
title: "Multivariate Data Analysis - chapter 06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(python = reticulate::eng_python)
```

# 6. 정준상관분석

## 1. 정준상관분석이란?

-   상관계수 : 두 연속형 변수 X,Y의 선형관계의 밀접도를 구하는 통계량ㅇ

-   몇 개의 변수들로 이루어진 집단들 사이의 연관성을 알고자 하는 경우

-   예\> 학생들의 신체조건과 운동능력 사이의 연관성 측정

    -   측정변수

        -   신체조건 변수( $X_1$ = 키, $X_2$ = 앉은키, $X_3$ = 가슴둘레)

        -   운동능력 변수( $Y_1$ =100m 달리기, $Y_2$ = 멀리뛰기, $Y_3$ = 높이뛰기, $Y_4$ = 공던지기)

-   물음: 신체조건과 운동능력 사이의 연관성을 어떻게 구할 수 있을 까?

-   접근방법 : 이와 같이 여러 개의 변수로 구성된 X 변수드로가 여러개의 변수로 이루어진 Y 변수들 사이의 연관성을 구하는 방법은 X 변수들의 선형결합으로 이루어진 변수와 Y 변수들의 선형결합으로 이루어진 변수들을 만들어 이들의 상관계수로 두 집단 사이의 상관성을 구함

    -   이와 같이 몇 개 변수들이 집단으로 관측된 두 집단 사이의 연관성(상관성)을 구하는 통계적분석방법이 정준상관분석임.

## 2. 정준상관분석모형

-   정준상관분석모형 : 두 변수집단 사이의 상관성을 구하기 위한 두 변수 집단의 선형결합 모형을 말함

-   학생들의 신체조건과 운동능력 사이의 연관성을 측정하기 위한 예에서 : 세 가지 신체조건과 네 가지 운동능력에서 변수집단 ( $X_1, X_2, X_3$ )와 ( $Y_1, Y_2, Y_3, Y_4$ )의 선형결합변수를 각각 W, V라 할때 다음을 구한 후에 변수 W와 V의 상관계수를 구함

    $$
    W = a_1 X_1 + a_2 X_2 + a_3 X_3 \\V = b_1 Y_1 + b_2 Y_2 + b_3 Y_3 + b_4 Y_4
    $$

-   (문1) 두 상관계수 ( $a_1, a_2, a_3$ )와 ( $b_1, b_2, b_3, b_4$ )는 어떻게 구하는가?

-   (문2) $W$ 와 $V$ 상관계수 값의 크기는 얼마인가?

## 3. 정준상관분석과정

### 단계 1: X 변수들과 Y 변수들의 선형식을

$$
W_1 = a_{11} X_1 + a_{12} X_2 + a_{13} X_3 \\V_1 = b_{11} Y_1 + b_{12} Y_2 + b_{13} Y_3 + b_{14} Y_4
$$

라 하고 $W_1$ 과 $V_1$ 의 상관계수를 $r_1$ 이라 함. 먼저 두 변수 $W_1$ 과 $V_1$ 의 상관계수 $r_1$ 이 최대가 되도록 선형계수 ( $a_{11}, a_{12}, a_{13}$ )와 ( $b_{11}, b_{12}, b_{13}, b_{14}$ ) 를 추정

### 단계 2: 다음 단계는 다른 선형결합 변수

$W_2 = a_{21} X_1 + a_{22} X_2 + a_{23} X_3 \\V_2 = b_{21} Y_1 + b_{22} Y_2 + b_{23} Y_3 + b_{24} Y_4$ 가 $W_1$, $V_1$ 과 각각 서로 독립이면서 $W_2$ 와 $V_2$ 의 상관계수 $r_2$ 가 최대가 되도록 하는 계수들을 찾음.

-   이와 같은 방법으로 새로운 선형 결합변수를 찾아나가는 과정이 정준상관분석 과정임

-   일반적으로 두 변수집단의 선형결합 쌍의 수는 크기가 작은 변수집단의 변수의 수가 됨.

[표 6-1]에서 두 변수집단의 선형결합 쌍의 수는 X 변수의 수=3이 됨. 그러나 그 관심의 초점은 두 변수집단 사이의 최다 상관계수를 가지는 선형결합으로 $W_1, V_1$ 과 이들의 상관계수 $r_1$ 의 크기에 의하여 두 변수집단 사이의 연관성의 크기를 측정

## 4. R을 이용한 정준상관분석

`예` 판매사원 50명을 대상으로 조사한 적성시험과 판매실적 자료가 \<자료 6.1\>과 같다. 적성시험은 4개 변수가 측정되고 판매실적은 3개 변수가 관측되었다.

+-------+---------------------------+------------------------+
| 항목  | 변수                      | 의미                   |
+:=====:+:=========================:+========================+
| 사원  | ID                        | 판매사원 번호          |
+-------+---------------------------+------------------------+
| 적성\ | $X_1\\ X_2 \\ X_3 \\ X_4$ | 창의력 시험점수\       |
| 시험  |                           | 조직적사고력 시험점수\ |
|       |                           | 추리력 시험점수\       |
|       |                           | 수리 시험점수          |
+-------+---------------------------+------------------------+
| 판매\ | $Y_1\\Y_2\\Y_3$           | 판매 성장률\           |
| 실적  |                           | 판매 이익률\           |
|       |                           | 새로운 고객 판매율     |
+-------+---------------------------+------------------------+

: 자료 6.1

```{r}
sales = read.csv("./data/sales.csv")

#산점도 및 상관계수 구하기
library(ggplot2)
library(GGally)
library(CCA)

exam = sales[, c(2:5)]
perform = sales[, c(6:8)]

# scatterplots and corr. of exam
ggpairs(perform)
matcor(exam, perform)

# 정준상관분석 실행하기
cano_result = cc(exam, perform)
names(cano_result)
cano_result$cor

# 정준상관분석 계수
round(cano_result$xcoef, 3)
round(cano_result$ycoef, 3)

# 정준상관 점수
cano_result$scores
```

## 5. 파이썬을 이용한 정준상관 분석

```{python}
import numpy as np
import pandas as pd

# read data
sales = pd.read_csv("./data/sales.csv")

# 변수군 리슽
xlist = ['X1', 'X2', 'X3', 'X4']
ylist = ['Y1', 'Y2', 'Y3']

# 변수 선택
exam = sales[xlist]
perform = sales[ylist]

# z-score 표준화
# Direct method using z = (x-μ)/std
X_mc = (exam - exam.mean())/exam.std()
Y_mc = (perform - perform.mean())/perform.std()

# 정준상관분석 실행
from sklearn.cross_decomposition import CCA
# CCA(n_components=2, scale=True) : 디폴드
ca = CCA(n_components=3)
ca.fit(exam, perform)
X_c, Y_c = ca.transform(exam, perform)

# 제1 정준상관계수
np.corrcoef(X_c[:,0], Y_c[:,0])

# 정준상간계수 - X군
ca.x_weights_

# 정준상관계수 - Y군
ca.y_weights_
```
