
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 제 2장 주성분 분석

## R을 이용한 주성분분석(1)

### (1) 자료 가져오기 및 요약통계량
```{r}
# install.packages("HSAUR2") # 패키지 설치
library(HSAUR2) # 패키지 로드
# data(heptathlon) # 교재에는 이렇게 사용하게 되어 있지만 없어도 문제 없는듯
head(heptathlon)
summary(heptathlon)
write.csv(heptathlon, file="./data/heptathlon.csv")
```

### (2) 자료 변형하기
변수들 중 hurdles, run200m, run800m은 작은 값이 빨리 들어온것이기 때문에 
높은 점수가 좋은 점수가 되도록 최대값에서 빼줌으로서 자료를 역변환 한다.
```{r}
heptathlon$hurdles = max(heptathlon$hurdles) - heptathlon$hurdles
heptathlon$run200m = max(heptathlon$run200m) - heptathlon$run200m
heptathlon$run800m = max(heptathlon$run800m) - heptathlon$run800m
head(heptathlon)
```

### (3) 주성분 분석 실행하기
```{r}
hep_data = heptathlon[,-8] # 반응변수 score는 제외한 데이터
# cor=T : 상관계수행렬을 지정, 
# scores=T : 각 케이스의 주성분점수를 포함하라라
hep_pca = princomp(hep_data, cor=T, scores=T) # 주성분분석 실행
names(hep_pca) # 주성분 분석결과의 변수 확인
print(hep_pca) # 주성분 분석 데이터 출력
```

### (4) 주성분분석 결과
#### ① 결과요약(summary)
```{r}
summary(hep_pca) # 주성분분석 결과의 요약정보 출력
# 주성분의 표준편차를 제곱하여 고윳값을 만든다.
(eig_val = hep_pca$sdev^2)
```
- 제1 중성분의 분산이 4.46, 제2주성분이 1.19, 제3주성분이 0.52로 유효한 주성분수는 2개임을 알 수 있다.

#### ② 스크리 그림과 주성분계수
```{r}
# 스크리 그림
screeplot(hep_pca, type="lines", pch=19, main="Scree plot")
```

- 스크리 그림에서 고윳값이 1보다 큰 주성분은 comp.1과 comp.2 임을 알 수 있다.


```{r}
# 누적분산 그림 그리기
hep_var = hep_pca$sdev^2
hep_var_ratio=round(hep_var/sum(hep_var),3)
plot(cumsum(hep_var_ratio), type='b', pch=19, xlab="Component", ylab="Cumulative Proportion")
title("Variance Explained")
```

- 누적분산 그림은 주성분의 표준편차를 제곱하여 분산을 구한 후 그림.


```{r}
# 주성분계수 
hep_pca$loadings[, c(1,2)]
```

- 주성분계수에서 상관계수행렬을 이용한 경우 제1, 제2 주성분은 다음과 같다.
  - $PC_1 = 0.453*hurdles + 0.377*highjump+0.363*shot+ ...+0.375*run800m$
  - $PC_2 = 0.158*hurdles + 0.248*highjump-0.289*shot+ ...+0.244*run800m$  
- 여기서 제1주성분은 javelin(창던지기)을 제외한 모든 변수의 절대값이  
  큰값을 가지는 것으로 볼때 전반적인 체력정도를 나타내는 성분이라고 할 수 있다.
- 또한 제 2 주성분은 javelin의 계수가 다른 변수에 비해 상대적으로 절대값이 큰것을 볼때,  
  창던지기와 밀접한 관련이 있는 성분으로 파악할 수 있다.
  
#### ③ 주성분점수 및 행렬도
```{r}
hep_pca$scores[, c(1,2,3)]
# 행렬도 그리기
biplot(hep_pca, cex=0.7, col=c("Red", "Blue"))
title("Biplot")
```

- 행렬도에서 'highjump, run800m, hurdles, longjump'가 서로 가꾸운 곳에 
  위치하며 벡터의 방향도 어느정도 비슷하다.  
  'run200m, shot'이 가깝게 위치하고, javelin은 다른 변수들과 다른 방향에 위치하고 있다.
- 가까운 거리와 방향일수록 변수들의 상관성이 높아지게 된다.  
  또한 각 개체가 특정 변수에 가깝게 위치할 수록
  그 개체는 해당 변수와 관련이 높다고 할 수 있다. 

## R을 이용한 주성분분석(2)
### (1) 자료읽기 및 요약통계량
```{r}
beer = read.csv("./data/beer.csv")
head(beer)
summary(beer)
```

### (2) 상관계수행렬 및 산점도행렬
```{r}
round(cor(beer),2)
plot(beer, pch=19)
```

- 맥주의 가격(cost), 크기(size), 알코올 함량(alcohol)의 상관관계가 높아 
  서로 양의 상관관계가 있을 것으로 보인다.  
  또한 색(color), 향기(aroma), 맛(taste)이 서로 상관계수가 높게 나타났다.
- 반면에 평판(reputat)은 다른 변수들과 상관계수가 비교적 높지 않으며, 
  다른 변수들과 모두 음의 상관계수를 나타냈다.
  
### (3) 주성분분석 실행
```{r}
# cof=F : 공분산행렬을 이용하라, 
# scores=T : 각 케이스의 주성분점수를 포함하라라
(beer_pca = princomp(beer, cor=F, scores=T))
```

- 주성분의 표준편차(Standard deviations)와 변수수, 케이스수를 보여주고 있다.

### (4) 주성분분석 결과
#### ①결과 요약(summary)
```{r}
summary(beer_pca)
```

- 표준편차 (Standard deviation)
- 분산의 비율(Proportion of Variance)
- 누적비율(Cumulative Proportion)

#### ② 스크리 그림 및 주성분 계수
```{r}
# 스크리 그림
screeplot(beer_pca, type="lines", pch=19)
```

- 스크리 그림에서 유효한 주성분은 3개로 판단

```{r}
#주성분계수
beer_pca$loadings[, c(1:3)]
```

- 주성분계수를 통해 3주성분은 
  - $PC_1 = 0.734*cost + 0.394*size + ... + 0.149*taste$
  - $PC_2 = 0.319*cost + 0.340*size + ... - 0.429*taste$
  - $PC_3 = 0.190*cost - 0.127*size + ... + 0.206*taste$
  

