---
title: "simple regression model test"
author: "robinhwp"
date: "2023-01-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 단순회귀모형 테스트

### 1. 데이터 로드

```{r}
# 데이터 로드 data/market-1.txt
market=read.table("./data/market-1.txt", header = TRUE)
```

### 2. 산점도

```{r}
# 산점도
plot(market$X, market$Y, xlab = "광고료", ylab = "매출", main="광고료와 판매액의 산점도도", pch=10)
#회귀직선을 그리려면 선형회귀모형을 구해야한다.
market.lm=lm(Y~X, data = market)
abline(market.lm)
```

### 3. summary 및 분산분석

```{r}
# summary
summary(market.lm)

```

### 4. 신뢰구간

```{r}

# use result of summary

alpha=0.05
# t(n-2;\alpha/2)
qval=qt(1-alpha/2, market.lm$df.residual)
paste("alpha:", alpha, "df:",market.lm$df.residual, ">  qt:",qval)  
# \beta_1
(b_1 = summary(market.lm)["coefficients"]$coefficients[2,1])
# \sqrt{\hat{var(b_1)}} # b_1에 대한 분산 추정값값
( serr_1 = summary(market.lm)["coefficients"]$coefficients[2,2])
paste("\beta_1 interval : lower:", round(b_1-(qval*serr_1),6), ", upper:", round(b_1+(qval*serr_1),6))

# \beta_0
(b_0 = summary(market.lm)["coefficients"]$coefficients[1,1])
# \sqrt{\hat{var(b_1)}} # b_1에 대한 분산 추정값값
( serr_0 = summary(market.lm)["coefficients"]$coefficients[1,2])
paste("\beta_0 interval : lower:", round(b_0-(qval*serr_0),6), ", upper:", round(b_0+(qval*serr_0),6))
      
```

```{r}
anova(market.lm)
```
위의 산점도에 추정값의 신뢰구간을 출력하는 방법
```{r}
pred.frame = data.frame(X=seq(3.5,14.5,0.2))
pc = predict(market.lm, int="c", newdata = pred.frame)
pp = predict(market.lm, int="p", newdata = pred.frame)
head(pc)
head(pp)
```
산점도 그리기
```{r}
plot(market$X, market$Y, ylim=range(market$Y, pp),xlab = "광고료", ylab = "매출", main="광고료와 판매액의 산점도도", pch=10)

matlines(pred.frame$X, pc, lty=c(1,2,2),col = "BLUE")
matlines(pred.frame$X, pp, lty=c(1,3,3),col = "RED")

```


### 5. $\beta_1$의 검정

추정된 회귀직선의 기울기 $b_1$ 의 분포는$b_1 \sim N\left( \beta_1, {\sigma^2 \over S_{XX}} \right)$이므로,
${b_1 -\beta_1 \over \sqrt{{MSE\over S_{XX}}}} \sim t(n-2)$를 따른다. 따라서 이를 이용하게 되면 모집단 회귀직선의 기울기 $\beta_1$에 대한 검정이 가능해진다. $\beta_1$의 값이 어떤 특정한 값 $\beta_{10}$이 아닌가 하는 가설을 검정하려면 다음과 같이 귀무가설과 대립가설을 설정한 후 적합된 회귀직선을 이용하여 검정한다.
귀무가설 $H_0: \beta_1 = \beta_{10}$\
대립가설 $H_0: \beta_1 \ne \beta_{10}$\
위의 가설 통계량은 
$$t_0 = {b_1 - \beta_{10} \over \sqrt{\widehat{Var}(b_1)}} = {b_1-\beta_{10} \over \sqrt{MSE\over S_{XX}}}$$ 
이며, 양측검정이므로 $t(n-2;\alpha/2)$인 기각값을 구한 후, 만약 $|t_0| > t(n-2;\alpha/2)$이면 귀무가설을 기각하게 된다.

```{r}

# t값
( t_0 = summary(market.lm)["coefficients"]$coefficients[2,1]/summary(market.lm)["coefficients"]$coefficients[2,2])

paste("t_0(", abs(t_0) , ") >  qt:",qval)

paste0("p-값=Pr(T>|",t_0,"|)=2X(1-Pr(T<",t_0,"))이므로,",2*(1-pt(t_0,length(market$X)-2)))
```
### 6. 가중회귀
```{r}
x=c(1,2,3,4,5)
y=c(2,3,5,8,7)
w=1/x
w.lm=lm(y~x, weights=w)
summary(w.lm)

paste0("가중회귀 직선 방정식 : Y_hat = ", +
        summary(w.lm)["coefficients"]$coefficients[1,1], " + ", +
        summary(w.lm)["coefficients"]$coefficients[2,1],"X", collapse = "\n")

# 분산분석표표
anova(w.lm)

```



### 1.7 분석사례
```{r}
super=read.table("./data/supermarket.txt", header = T)
plot(super$price, super$time, pch=19)

super.lm = lm(price ~ time, data = super)
summary(super.lm)

paste0("time_hat=", summary(super.lm)["coefficients"]$coefficients[1,1], " + ", +
         summary(super.lm)["coefficients"]$coefficients[2,1],"X")

anova(super.lm)

cbind(super, super.lm$residuals, super.lm$fitted.values)
plot(super$price, super.lm$residuals, pch=19)
abline(h=0, lty=2)

```

```{r}

p.x<-data.frame(price= seq(1,45,5))
pc=predict(super.lm, int="c", newdata = p.x)
pred.x=p.x$price
plot(super$price, super$time, ylim=range(super$time , pc))
matlines(pred.x, pc, lty=c(1,2,2), col="BLUE")
```

